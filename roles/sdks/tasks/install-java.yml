- name: Install java-11-openjdk-devel
  become: true
  tags:
    - dev
  block:
    - name: Install OpenJDK-11 (Ubuntu)
      ansible.builtin.package:
        name:
          - openjdk-11-jdk
      when: ansible_distribution == "Ubuntu"

    - name: Install OpenJDK-11 (Fedora)
      ansible.builtin.package:
        name:
          - java-11-openjdk-devel.x86_64
      when: ansible_distribution == "Fedora"

- name: Install Coursier
  block:
    - name: Download Coursier
      ansible.builtin.get_url:
        url: https://github.com/coursier/launchers/raw/master/cs-x86_64-pc-linux.gz
        dest: /tmp/cs-x86_64-pc-linux.gz

    # - name: Extract Coursier
    #   ansible.builtin.unarchive:
    #     src: /tmp/cs-x86_64-pc-linux.gz
    #     dest: /tmp
    #     remote_src: yes
    #     mode: '+x'
    - name: Extract Coursier
      ansible.builtin.shell:
        cmd: gzip -d cs-x86_64-pc-linux.gz
        chdir: /tmp

    - name: Make Coursier Executable
      ansible.builtin.copy:
        src: /tmp/cs-x86_64-pc-linux
        dest: /tmp/cs
        mode: +x
        remote_src: true

    - name: Install Coursier
      ansible.builtin.shell:
        cmd: ./cs setup --yes
        chdir: /tmp

    - name: Delete Coursier Download
      ansible.builtin.file:
        path: /tmp/cs-x86_64-pc-linux
        state: absent

    - name: Delete Coursier Download
      ansible.builtin.file:
        path: /tmp/cs
        state: absent

    - name: Install Metals
      ansible.builtin.shell:
        cmd: ./cs install metals
        chdir: "{{ lookup('env', 'HOME') }}/.local/share/coursier/bin"
