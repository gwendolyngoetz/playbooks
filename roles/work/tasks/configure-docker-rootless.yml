- block:
  - name: Install required system packages
    ansible.builtin.package:
      name: 
        - dbus-user-session
        - uidmap

  - name: Disable system-wide docker daemon service
    ansible.builtin.systemd:
      name: docker.service
      state: stopped
      enabled: no

  - name: Disable system-wide docker daemon socket
    ansible.builtin.systemd:
      name: docker.socket
      state: stopped
      enabled: no
  become: true

- block:
  - name: Run docker rootless setup tool
    ansible.builtin.command: /usr/bin/dockerd-rootless-setuptool.sh install

  - name: Set path
    ansible.builtin.lineinfile: 
      path: $HOME/.bashrc
      line: export PATH=/usr/bin:$PATH

  - name: Set docker host
    ansible.builtin.lineinfile: 
      path: $HOME/.bashrc
      line: export DOCKER_HOST=unix:///run/user/1000/docker.sock

  - name: Enable user docker daemon socket
    ansible.builtin.systemd:
      name: docker.service
      scope: user
      state: started
      enabled: yes

